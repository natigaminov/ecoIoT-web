# ecoiot_server

Серверная часть проекта EcoIoT. Принимает POST запросы от датчика и записывает данные в БД. Доступ к БД осуществляется через специальный веб-интерфейс

Состоит из трех docker-контейнеров:
 - ecoiot_postgresql - СУБД PostgreSQL 14.4
 - ecoiot_postgresql_adminer - веб-интерфейс Adminer
 - ecoiot_server - FastAPI сервер с автодокой и интерактивными API (Swagger)

## Внешние зависимости
 - Docker-compose >= 1.27 (желательно 1.29)
 - Docker >= 20.10.12
 - Python 3.9 (для отладки)
 - Ubuntu >= 18.04

## Установка
Для установки внешней зависимости docker-compose запустите скрипт:
```bash
bash prerequisites.sh
```
Остальные внешние зависимости разрешайте в частном порядке

Для установки внутренних зависимостей при отладке используйте команду:
```bash
pip install -r requirements.txt
```

## Запуск:
Перед запуском обязательно переименуйте или скопируйте файл `.env.example` в `.env`
и в нем укажите необходимые значения переменных:
 - `dbms_admin_login` - логин админа для СУБД
 - `dbms_admin_pwd` - пароль админа для СУБД
 - `dbms_host` - адрес хоста СУБД, для отладки значение `localhost`, для деплоя `postgresql`, т.к. при деплое сервисы соединяются по внутренней сети docker
 - `gases_database_name` - имя БД для газовых значений датчиков
 - `api_access_token` - токен доступа к API (эндпоинтам)

После чего для деплоя введите:
```bash
docker-compose up -d
```
Для отладки закомментируйте в файле `docker-compose.yaml` сервис `ecoiot_server`,
также в файле `.env` укажите у переменной `dbms_host` значение `localhost`, после чего выполните команду:
```bash
docker-compose up -d
```
При это поднимутся только сервис с СУБД и веб-интерфейсом для нее.

Сам сервер отдельно запустите командой:
```bash
python -m app
```

## Документация API
Для просмотра и интерактивного использования API перейдите по адресу `localhost:8090/docs`, 
там можно увидеть описание входных значений, ответов эндпоинтов, описания и прочее, также можно использовать API в интерактивном режиме.
В дополнение есть другой вид интерфейса документации Swagger по адресу `localhost:8090/redoc`, но в нем отсутствует интерактивный режим

## Доступ к СУБД
Для просмотра и прочего взаимодействия с СУБД перейдите по адресу `localhost:8085` в веб-интейрфейс Adminer,
где нужно будет ввести логин и пароль из файла `.env`
